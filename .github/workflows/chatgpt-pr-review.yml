name: ChatGPT README Auto-Enhancer

on:
  push:
    branches: [main]
  workflow_dispatch:

jobs:
  enhance-readme:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install jq
        run: sudo apt-get update && sudo apt-get install -y jq

      - name: Read current README
        id: readme
        run: |
          if [ -f "README.md" ]; then
            echo "content<<EOF" >> $GITHUB_OUTPUT
            cat README.md >> $GITHUB_OUTPUT
            echo "EOF" >> $GITHUB_OUTPUT
          else
            echo "content<<EOF" >> $GITHUB_OUTPUT
            echo "El proyecto a煤n no tiene README.md" >> $GITHUB_OUTPUT
            echo "EOF" >> $GITHUB_OUTPUT
          fi

      - name: Generate enhanced README
        id: chatgpt
        run: |
          README_CONTENT=$(echo "${{ steps.readme.outputs.content }}" | sed 's/"/\\"/g')

          RESPONSE=$(curl -s https://api.openai.com/v1/chat/completions \
            -H "Content-Type: application/json" \
            -H "Authorization: Bearer ${{ secrets.OPENAI_API_KEY }}" \
            -d "{
              \"model\": \"gpt-4o-mini\",
              \"messages\": [
                {
                  \"role\": \"system\",
                  \"content\": \"Eres un redactor t茅cnico experto en R, documentaci贸n y repositorios de datos. Tu tarea es reescribir README.md con estilo profesional, manteniendo la informaci贸n actual pero mejorando estructura, claridad, formato y presentaci贸n. Incluye badges, secciones de instalaci贸n, uso, dependencias y ejemplos si son relevantes. No inventes c贸digo nuevo, pero sugiere d贸nde incluir im谩genes o gr谩ficos del repositorio.\"
                },
                {
                  \"role\": \"user\",
                  \"content\": \"Aqu铆 est谩 el README actual. Devuelve una nueva versi贸n mejorada, profesional y lista para reemplazar el archivo:\n\n$README_CONTENT\"
                }
              ],
              \"temperature\": 0.4
            }" | jq -r '.choices[0].message.content')

          echo "$RESPONSE" > README.md

      - name: Commit and push updated README
        run: |
          git config --global user.name "ChatGPT Agent"
          git config --global user.email "actions@github.com"
          git add README.md
          git commit -m " Mejora autom谩tica del README con ChatGPT"
          git push
